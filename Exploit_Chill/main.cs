using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Exploit_Chill
{
    public partial class main : Form
    {
        ArrayList players;
        int counter;
        int round;
        int roundOver;
        string pName;
        Bitmap chill;
        Bitmap exploit;
        Random q;

        public main()
        {
            InitializeComponent();

            //internal turn counter
            counter = 0;
            round = 1;
            button1.Enabled = false;
            button2.Enabled = false;
            button3.Enabled = false;

            //Images to at least provide fun while 'playing'
            chill = new Bitmap("..\\Resources\\Images\\cat.jpg");
            exploit = new Bitmap("..\\Resources\\Images\\gold.jpg");
            q = new Random();

        }

        private void button1_Click(object sender, EventArgs e)
        {
            Player temp = (Player)players[counter % 3];
            temp.D_choice = 'C';
            RandomQuotes(temp.D_choice);
            counter++;
            button1.Enabled = false;
            button2.Enabled = false;
            button3.Enabled = true;
        }

        private bool EndGame()
        {
            if (round > roundOver)
                return true;
            else
                return false;
        }

        private void button2_Click(object sender, EventArgs e)
        {
            Player temp = (Player)players[counter % 3];
            temp.D_choice = 'E';
            RandomQuotes(temp.D_choice);
            counter++;
            button1.Enabled = false;
            button2.Enabled = false;
            button3.Enabled = true;
        }

        private void button3_Click(object sender, EventArgs e)
        {
            if (counter % 3 == 0)
            {
                Player temp = (Player)players[counter % 3];
                button3.Enabled = false;
                button1.Enabled = true;
                button2.Enabled = true;
                pictureBox1.Image = temp.This_Pic;
                label3.Text = temp.D_name+"'s";
                UpdateRound();
            }
            else {
                Run_Next();
            }
        }
        private void UpdateRound()
        {
            round++;
            label16.Text = Convert.ToString(round);
            UpdateScore();
            if(EndGame())
            {
                label16.Text = "Done";
                int num = Convert.ToInt32(label10.Text);
                int num1 = Convert.ToInt32(label14.Text);
                int num2 = Convert.ToInt32(label11.Text);
                Player a = (Player)players[0];
                CPU_Player b=(CPU_Player)players[1];
                CPU_Player c = (CPU_Player)players[2];
                string s;
                if (num > num1)
                {
                    if (num > num2)
                        s = "Winner is " + a.D_name;
                    else if (num == num2) { s = "We have a tie!"; }
                    else
                    {
                        s = "Winner is " + c.D_Name;
                    }
                        
                }
                else
                {
                    if (num == num1 && num1>num2) { s = "We have a tie!"; }
                    else if (num1 == num2) { s = "We have a three-way tie!"; }
                    else if (num1 < num2) { s = "Winner is " + c.D_Name; }
                    else
                    {
                        if (num1 > num2)
                            s = "Winner is " + b.D_Name;
                        else
                            s = "Winner is " + c.D_Name;
                    }

                }
                MessageBox.Show(s, "We have a winner!");
                Reset();

                
            }
        }

        public void UpdateScore()
        {
            //All exploits (3,5,2)
            //Player Chill, both CPU exploits (-3, 4, 2)
            //Player and CPU2 exploits, CPU1 chills (4,6,4)
            //Player and CPU1 chills, CPU2 Exploits (1,-1,2)

            //Player and CPU1 exploits, CPU2 Chills (-2,-4,1)
            //Player and CPU2 chills, CPU1 exploits (2,1,3)
            //Player exploits, CPU1 and CPU2 chills (3,2,-1)
            //All chills (2,2,2)
            Player a = (Player)players[0];
            CPU_Player b = (CPU_Player)players[1];
            CPU_Player c = (CPU_Player)players[2];
            int num = Convert.ToInt32(label10.Text);
            int num1= Convert.ToInt32(label14.Text);
            int num2= Convert.ToInt32(label11.Text);

            //10,14,11 labelbox
            switch (a.D_choice)
            {
                case 'E':
                    if (b.D_Choice == 'E')
                    {
                        if (c.D_Choice == 'E')
                        {
                            num += 3;
                            num1 += 5;
                            num2 += 2;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox10.BackColor = Color.Yellow;
                        }
                        if( c.D_Choice == 'C')
                        {
                            num += -2;
                            num1 += -4;
                            num2 += 1;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox9.BackColor = Color.Yellow;
                        }
                    }
                    if(b.D_Choice=='C')
                    {
                        if (c.D_Choice == 'E')
                        {
                            num += 4;
                            num1 += 6;
                            num2 += 4;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox5.BackColor = Color.Yellow;
                        }
                        if (c.D_Choice == 'C')
                        {
                            num += 3;
                            num1 += 2;
                            num2 += -1;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox6.BackColor = Color.Yellow;
                        }
                    }
                    break;
                case 'C':
                    if (b.D_Choice == 'E')
                    {
                        if (c.D_Choice == 'E')
                        {
                            num += -3;
                            num1 += 4;
                            num2 += 2;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox3.BackColor = Color.Yellow;
                        }
                        if (c.D_Choice == 'C')
                        {
                            num += 2;
                            num1 += 1;
                            num2 += 3;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox4.BackColor = Color.Yellow;
                        }
                    }
                    if (b.D_Choice == 'C')
                    {
                        if (c.D_Choice == 'E')
                        {
                            num += 1;
                            num1 += -1;
                            num2 += 2;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox7.BackColor = Color.Yellow;
                        }
                        if (c.D_Choice == 'C')
                        {
                            num += 2;
                            num1 += 2;
                            num2 += 2;
                            label10.Text = Convert.ToString(num);
                            label14.Text = Convert.ToString(num1);
                            label11.Text = Convert.ToString(num2);
                            textBox8.BackColor = Color.Yellow;
                        }
                    }
                    break;
            }



        }

        private void Run_Next()
        {
            CPU_Player temp = (CPU_Player)players[counter % 3];
            Player p = (Player)players[0];
            int rand;
            if (counter % 3 == 1)
            {
                if (p.D_choice == 'E')
                {
                    rand = q.Next(20, 60);
                    if (rand > 45)
                    {
                        temp.D_Choice = 'E';
                    }
                    else
                    {
                        temp.D_Choice = 'C';
                    }
                }
                else
                {
                    temp.D_Choice = 'C';
                    
                }
            }
            if (counter % 3 ==2)
            {
                rand = q.Next(1, 4);
                if (rand == 2)
                {
                    temp.D_Choice = 'C';
                }
                else
                {
                    temp.D_Choice = 'E';
                }
                
            }
            pictureBox1.Image = temp.This_Pic;
            label3.Text = temp.D_Name + "'s";
            RandomQuotes(temp.D_Choice);
            Console.Write(counter);
            counter++;
        }

        private void setValuesToolStripMenuItem_Click(object sender, EventArgs e)
        {
            try {
                roundOver = Convert.ToInt32(textBox1.Text);
                button3.Enabled = false;
                button1.Enabled = true;
                button2.Enabled = true;
                label12.Text = "";
            }
            catch (Exception) { label12.Text = "Enter valid integer on rounds."; }
            pName = textBox2.Text;

            //setting up cpu player name and images
            players = new ArrayList();
            Bitmap a = new Bitmap("..\\Resources\\Images\\blind-item.jpg");
            players.Add(new Player(pName, a));
            a = new Bitmap("..\\Resources\\Images\\kguya.jpg");
            players.Add(new CPU_Player("Kaguya", a));
            a = new Bitmap("..\\Resources\\Images\\orekii.jpg");
            players.Add(new CPU_Player("Oreki", a));

            //display player image
            Player temp = (Player)players[0];
            pictureBox1.Image = temp.This_Pic;
            label3.Text = temp.D_name+"'s";
            label5.Text = temp.D_name;


        }
        public void RandomQuotes(char choice)
        {
            string [] quotesExp = new string[] { "Ahemm you wanna exploit! Go get them mortal!", "Find them keepers!", "Tsk! So you only know of greed."};
            string[] quotesChil = new string[] { "As cool as the sea breeze.", "Have you ever wonder a life where to live is to sleep?", "YES! YES! There's gold in patience!!!" };
            if (choice == 'E')
            {
                label2.Text = quotesExp[q.Next(0,quotesExp.Length)];
            }
            else {
                label2.Text = quotesChil[q.Next(0, quotesChil.Length)];
            }
            
        }

        private void resetToolStripMenuItem_Click(object sender, EventArgs e)
        {
            Reset();
        }
        private void Reset()
        {
            counter = 0;
            round = 1;
            label16.Text = "1";
            label3.Text = "None";
            label10.Text = "0";
            label14.Text = "0";
            label11.Text = "0";
            label2.Text = "";
            textBox1.Text = "";
            pictureBox1.Image = null;
            button1.Enabled = false;
            button2.Enabled = false;
            button3.Enabled = false;
        }
    }
}
